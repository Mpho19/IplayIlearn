<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPlay iLearn | Fun Learning for Kids</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#fef9f0;--blue:#4a9ff5;--blue-l:#e8f2ff;--green:#5cc775;--green-l:#e6f9ec;--orange:#f5a623;--orange-l:#fff3e0;--pink:#f06292;--pink-l:#fde8ef;--purple:#9b6dff;--purple-l:#f0e8ff;--red:#ef5350;--yellow:#ffe066;--teal:#26a69a;--teal-l:#e0f2f1;--dark:#2d2040;--text:#3a2d50;--text-l:#8a7da0;--white:#fff;--r:20px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}
.hdr{background:var(--white);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:3px solid var(--yellow);position:sticky;top:0;z-index:500}
.logo{font-family:'Fredoka',sans-serif;font-size:22px;font-weight:700;cursor:pointer}
.logo .c1{color:var(--blue)}.logo .c2{color:var(--orange)}.logo .c3{color:var(--green)}.logo .c4{color:var(--pink)}
.hdr-r{display:flex;align-items:center;gap:8px}
.streak-badge{display:flex;align-items:center;gap:4px;padding:5px 12px;background:linear-gradient(135deg,#fff3e0,#fde8ef);border-radius:50px;font-family:'Fredoka';font-size:13px;font-weight:700;color:var(--orange)}
.lang-sw{display:flex;gap:2px;background:var(--bg);padding:2px;border-radius:8px}
.lang-b{padding:5px 12px;border:none;border-radius:7px;background:none;font-family:'Nunito';font-size:11px;font-weight:700;color:var(--text-l);cursor:pointer;transition:.3s}
.lang-b.act{background:var(--white);color:var(--dark);box-shadow:0 2px 6px rgba(0,0,0,.05)}
.view{display:none}.view.act{display:block}

/* PROFILE */
.profile-screen{text-align:center;padding:50px 20px;max-width:500px;margin:0 auto}
.profile-screen h1{font-family:'Fredoka';font-size:clamp(24px,5vw,36px);margin-bottom:6px}
.profile-screen>.sub{font-size:14px;color:var(--text-l);font-weight:600;margin-bottom:28px}
.avatar-grid{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:24px}
.avatar-opt{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;border:4px solid #e8e0f0;cursor:pointer;transition:.2s;background:var(--white)}
.avatar-opt:hover{transform:scale(1.1);border-color:var(--purple)}
.avatar-opt.sel{border-color:var(--green);background:var(--green-l);transform:scale(1.1);box-shadow:0 4px 16px rgba(92,199,117,.3)}
.profile-form{text-align:left;background:var(--white);border-radius:var(--r);padding:24px;box-shadow:0 4px 20px rgba(0,0,0,.05);margin-bottom:20px}
.pf-label{font-family:'Fredoka';font-size:13px;color:var(--text);margin-bottom:6px;display:block}
.pf-input{width:100%;padding:12px 16px;border:3px solid #e8e0f0;border-radius:12px;font-family:'Nunito';font-size:16px;font-weight:600;color:var(--dark);outline:none;transition:.3s;margin-bottom:16px;background:var(--bg)}
.pf-input:focus{border-color:var(--purple)}
.pf-input::placeholder{color:var(--text-l)}
.age-pills{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.age-pill{padding:10px 18px;border-radius:50px;border:3px solid #e8e0f0;background:var(--white);font-family:'Fredoka';font-size:15px;font-weight:600;cursor:pointer;transition:.2s;color:var(--text)}
.age-pill:hover{border-color:var(--purple)}
.age-pill.sel{border-color:var(--green);background:var(--green-l);color:var(--green)}
.pf-submit{width:100%;padding:14px;border:none;border-radius:14px;background:var(--green);color:white;font-family:'Fredoka';font-size:18px;font-weight:700;cursor:pointer;transition:.3s}
.pf-submit:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(92,199,117,.3)}
.pf-submit:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}

/* Profile cards (selection) */
.profile-cards{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;margin-bottom:24px}
.pcard{width:130px;padding:24px 16px;border-radius:20px;background:var(--white);box-shadow:0 4px 16px rgba(0,0,0,.05);text-align:center;cursor:pointer;transition:.3s;border:4px solid transparent}
.pcard:hover{transform:translateY(-4px);border-color:var(--purple);box-shadow:0 8px 30px rgba(0,0,0,.1)}
.pcard .pav{font-size:48px;display:block;margin-bottom:8px}
.pcard .pname{font-family:'Fredoka';font-size:15px;color:var(--dark);margin-bottom:2px}
.pcard .page{font-size:11px;color:var(--text-l);font-weight:600}
.pcard .pstreak{font-size:12px;color:var(--orange);font-weight:700;margin-top:6px}
.pcard-add{width:130px;padding:24px 16px;border-radius:20px;background:var(--bg);border:3px dashed #e0d6f0;text-align:center;cursor:pointer;transition:.3s;display:flex;flex-direction:column;align-items:center;justify-content:center}
.pcard-add:hover{border-color:var(--purple);background:var(--purple-l)}
.pcard-add .plus{font-size:36px;color:var(--text-l);margin-bottom:4px}
.pcard-add .atxt{font-family:'Fredoka';font-size:12px;color:var(--text-l)}

/* Header profile button */
.hdr-profile{display:flex;align-items:center;gap:6px;padding:4px 10px 4px 4px;background:var(--bg);border-radius:50px;cursor:pointer;transition:.2s;border:2px solid transparent}
.hdr-profile:hover{border-color:var(--purple)}
.hdr-profile .hp-av{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;background:var(--white)}
.hdr-profile .hp-name{font-family:'Fredoka';font-size:12px;font-weight:600;color:var(--dark)}

/* Delete profile */
.pcard-del{position:absolute;top:-6px;right:-6px;width:24px;height:24px;border-radius:50%;background:var(--red);color:white;font-size:11px;border:2px solid var(--white);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2;box-shadow:0 2px 6px rgba(239,83,80,.3)}

/* AGE SELECT */
.age-sel{text-align:center;padding:50px 20px}
.age-sel h1{font-family:'Fredoka';font-size:clamp(24px,5vw,38px);margin-bottom:6px}
.age-sel>.sub{font-size:14px;color:var(--text-l);font-weight:600;margin-bottom:30px}
.age-cards{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;max-width:640px;margin:0 auto}
.acard{flex:1;min-width:240px;max-width:300px;padding:32px 20px;border-radius:22px;cursor:pointer;transition:.35s;border:4px solid transparent;text-align:center;color:white;overflow:hidden}
.acard:hover{transform:translateY(-5px);border-color:rgba(255,255,255,.5);box-shadow:0 14px 44px rgba(0,0,0,.1)}
.acard.exp{background:linear-gradient(135deg,#4a9ff5,#80c4ff)}.acard.bld{background:linear-gradient(135deg,#9b6dff,#c4a3ff)}
.acard .em{font-size:48px;margin-bottom:12px;display:block}
.acard h2{font-family:'Fredoka';font-size:22px;margin-bottom:4px}
.acard .ages{font-size:12px;background:rgba(255,255,255,.2);display:inline-block;padding:3px 12px;border-radius:50px;margin-bottom:8px;font-weight:700}
.acard p{font-size:11px;opacity:.85;line-height:1.5;font-weight:600}

/* MODS */
.mods{padding:20px 20px 50px;max-width:860px;margin:0 auto}
.mods h2{font-family:'Fredoka';font-size:clamp(20px,4vw,28px);text-align:center;margin-bottom:4px}
.mods>.sub{text-align:center;color:var(--text-l);font-weight:600;margin-bottom:20px;font-size:13px}
.mg{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.mc{padding:22px 18px;border-radius:var(--r);cursor:pointer;transition:.3s;color:white;position:relative;overflow:hidden;border:3px solid transparent}
.mc:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,0,0,.1);border-color:rgba(255,255,255,.4)}
.mc.locked{opacity:.5;pointer-events:none}
.mc .ico{font-size:32px;margin-bottom:8px;display:block}
.mc h3{font-family:'Fredoka';font-size:16px;margin-bottom:3px}
.mc p{font-size:11px;opacity:.9;line-height:1.4;font-weight:600}
.mc .go{display:inline-block;margin-top:10px;padding:6px 14px;background:rgba(255,255,255,.25);border-radius:50px;font-size:11px;font-weight:800}
.mc .lock-timer{position:absolute;inset:0;background:rgba(0,0,0,.5);display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:var(--r);backdrop-filter:blur(2px)}
.mc .lock-timer .lock-ico{font-size:28px;margin-bottom:4px}
.mc .lock-timer .lock-txt{font-size:11px;font-weight:700}

/* REWARD BAR */
.reward-bar{background:var(--white);border-radius:16px;padding:14px 18px;margin-bottom:18px;box-shadow:0 2px 12px rgba(0,0,0,.04);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.rb-streak{display:flex;align-items:center;gap:8px}
.rb-streak .fire{font-size:24px}
.rb-streak .s-num{font-family:'Fredoka';font-size:20px;font-weight:700;color:var(--orange)}
.rb-streak .s-label{font-size:11px;color:var(--text-l);font-weight:600}
.rb-medals{display:flex;gap:6px}
.medal{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;border:2px solid #e0d6f0;background:var(--bg)}
.medal.earned{border-color:var(--yellow);background:#fffde7;box-shadow:0 2px 8px rgba(245,166,35,.2)}
.rb-stars{font-family:'Fredoka';font-size:14px;color:var(--purple);display:flex;align-items:center;gap:4px}

/* GA */
.ga{padding:18px 20px 50px;max-width:780px;margin:0 auto}
.back{display:inline-flex;align-items:center;gap:5px;padding:7px 14px;border:2px solid #e0d6f0;border-radius:50px;background:var(--white);font-family:'Nunito';font-size:12px;font-weight:700;color:var(--text);cursor:pointer;margin-bottom:14px;transition:.3s}
.back:hover{border-color:var(--purple);color:var(--purple)}
.ga h2{font-family:'Fredoka';font-size:22px;margin-bottom:3px}
.ga>.sub{color:var(--text-l);font-weight:600;margin-bottom:16px;font-size:12px}
.wcard{background:var(--white);border-radius:var(--r);box-shadow:0 3px 16px rgba(0,0,0,.04);padding:24px;margin-bottom:14px;text-align:center}
.big{font-family:'Fredoka';font-size:80px;font-weight:700;line-height:1;margin-bottom:4px}
.big.blue{color:var(--blue)}.big.green{color:var(--green)}
.word{font-family:'Fredoka';font-size:20px;color:var(--dark);margin-bottom:3px}
.tlang{font-size:12px;color:var(--text-l);font-weight:600;padding:4px 12px;background:var(--orange-l);border-radius:50px;display:inline-block;margin-top:4px}
.dots{display:flex;justify-content:center;gap:6px;flex-wrap:wrap;margin:12px 0}
.dot{width:24px;height:24px;border-radius:50%;animation:popIn .3s ease backwards}
.ctrls{display:flex;justify-content:center;gap:8px;margin-top:12px}
.cbtn{width:48px;height:48px;border-radius:50%;border:3px solid;font-family:'Fredoka';font-size:18px;font-weight:700;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center}
.cbtn:hover{transform:scale(1.1)}
.cbtn.prev{background:var(--pink-l);border-color:var(--pink);color:var(--pink)}
.cbtn.next{background:var(--green-l);border-color:var(--green);color:var(--green)}
.cbtn.spk{background:var(--blue-l);border-color:var(--blue);color:var(--blue);font-size:16px}
.prog{display:flex;align-items:center;gap:8px;padding:7px 12px;background:var(--white);border-radius:50px;box-shadow:0 2px 8px rgba(0,0,0,.03);margin-bottom:14px;width:fit-content}
.prog .star{font-size:14px}
.prog-t{width:100px;height:6px;background:#f0e8f8;border-radius:6px;overflow:hidden}
.prog-f{height:100%;border-radius:6px;background:linear-gradient(90deg,var(--green),var(--blue));transition:width .5s}
.prog-tx{font-size:10px;font-weight:800;color:var(--text-l)}
.lgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:14px}
.lcell{aspect-ratio:1;border-radius:9px;background:var(--white);box-shadow:0 2px 5px rgba(0,0,0,.03);display:flex;align-items:center;justify-content:center;font-family:'Fredoka';font-size:16px;font-weight:700;cursor:pointer;transition:.2s;border:3px solid transparent}
.lcell:hover{transform:scale(1.05);border-color:var(--green)}.lcell.act{background:var(--green);color:white;border-color:var(--green)}

/* CODE */
.code-wrap{background:var(--white);border-radius:var(--r);box-shadow:0 3px 16px rgba(0,0,0,.04);overflow:hidden;margin-bottom:14px}
.ch-bar{padding:14px 16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
.ch-bar.e-ch{background:linear-gradient(135deg,#e8f2ff,#f0e8ff);border-bottom:3px solid var(--blue)}
.ch-bar.b-ch{background:linear-gradient(135deg,#f0e8ff,#fde8ef);border-bottom:3px solid var(--purple)}
.ch-info h4{font-family:'Fredoka';font-size:15px;margin-bottom:2px}
.ch-info .dbadge{font-size:10px;padding:2px 8px;border-radius:50px;background:rgba(255,255,255,.5);font-weight:700;margin-left:6px;color:var(--text-l)}
.ch-info p{font-size:11px;color:var(--text-l);font-weight:600}
.ch-stars{font-size:18px}
.cbody{padding:16px}
.lbl{font-size:9px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-l);margin-bottom:6px}
.concept{padding:12px 14px;border-radius:10px;margin-bottom:14px;display:flex;align-items:center;gap:10px}
.concept.c-seq{background:#e8f2ff;border-left:4px solid var(--blue)}
.concept.c-loop{background:#f0e8ff;border-left:4px solid var(--purple)}
.concept.c-cond{background:#e6f9ec;border-left:4px solid var(--green)}
.concept.c-func{background:#fff3e0;border-left:4px solid var(--orange)}
.concept .ci{font-size:24px;flex-shrink:0}
.concept h5{font-family:'Fredoka';font-size:13px;margin-bottom:1px}
.concept p{font-size:11px;color:var(--text-l);font-weight:600;line-height:1.4}
.btray{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:14px}
.blk{padding:7px 12px;border-radius:8px;font-family:'Fredoka';font-size:12px;font-weight:600;cursor:pointer;transition:.2s;user-select:none}
.blk:hover{transform:scale(1.04)}
.blk.b-m{background:var(--blue-l);color:var(--blue)}.blk.b-t{background:var(--green-l);color:var(--green)}
.blk.b-a{background:var(--orange-l);color:var(--orange)}.blk.b-l{background:var(--pink-l);color:var(--pink)}
.blk.b-c{background:var(--purple-l);color:var(--purple)}
.seq{min-height:42px;border:3px dashed #e0d6f0;border-radius:10px;padding:6px;display:flex;flex-wrap:wrap;gap:4px;align-items:center;margin-bottom:12px}
.seq .blk{position:relative;cursor:default}
.seq .blk .rx{position:absolute;top:-4px;right:-4px;width:14px;height:14px;border-radius:50%;background:var(--red);color:white;font-size:8px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;transition:.2s}
.seq .blk:hover .rx{opacity:1}
.seq-ph{color:var(--text-l);font-size:11px;font-weight:600;width:100%;text-align:center}
.world{display:grid;gap:2px;border-radius:10px;padding:8px;margin-bottom:12px;position:relative}
.world.ew{background:#e8f2ff;grid-template-columns:repeat(8,1fr)}
.world.bw{background:#f0e8ff;grid-template-columns:repeat(10,1fr)}
.wcell{aspect-ratio:1;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:clamp(12px,2.5vw,20px);transition:.3s}
.wcell.fl{background:#dce8f8}.wcell.wl{background:#8a7da0}.wcell.bt{background:#d4f5dd;border:2px solid var(--green)}
.wcell.gl{background:#fff3e0}.wcell.pt{background:#c8e6c9}.wcell.it{background:#fde8ef}
.rrow{display:flex;gap:6px}
.rbtn{flex:1;padding:10px;border:none;border-radius:10px;font-family:'Fredoka';font-size:14px;font-weight:700;cursor:pointer;transition:.3s;display:flex;align-items:center;justify-content:center;gap:5px;color:white}
.rbtn:hover{transform:translateY(-2px)}.rbtn:disabled{opacity:.4;cursor:not-allowed;transform:none}
.rbtn.run{background:var(--green)}.rbtn.clr{background:var(--red);flex:0;padding:10px 14px}
.result-overlay{display:none;position:absolute;inset:0;border-radius:10px;background:rgba(255,255,255,.95);flex-direction:column;align-items:center;justify-content:center;z-index:10}
.result-overlay.act{display:flex}
.result-overlay .ri{font-size:48px;margin-bottom:8px}
.result-overlay .rm{font-family:'Fredoka';font-size:20px;margin-bottom:3px}
.result-overlay .rs{font-size:12px;color:var(--text-l);font-weight:600;margin-bottom:10px}
.result-overlay .rb{padding:8px 20px;border-radius:50px;border:none;background:var(--green);color:white;font-family:'Fredoka';font-size:13px;cursor:pointer}

/* COMPLETION SCREEN */
.complete-screen{text-align:center;padding:40px 20px}
.complete-screen .trophy{font-size:72px;margin-bottom:12px;display:block;animation:bounce 1s infinite}
.complete-screen h3{font-family:'Fredoka';font-size:24px;color:var(--dark);margin-bottom:6px}
.complete-screen p{font-size:14px;color:var(--text-l);font-weight:600;margin-bottom:4px}
.complete-screen .timer{font-family:'Fredoka';font-size:28px;color:var(--purple);margin:16px 0}
.complete-screen .medal-earned{font-size:48px;margin:12px 0}
.complete-screen .streak-msg{font-family:'Fredoka';font-size:16px;color:var(--orange);margin-bottom:16px}
.complete-screen .home-btn{padding:12px 30px;border-radius:50px;border:none;background:var(--purple);color:white;font-family:'Fredoka';font-size:16px;cursor:pointer;transition:.2s}
.complete-screen .home-btn:hover{transform:scale(1.05)}

/* MATH */
.math-tabs{display:flex;gap:5px;justify-content:center;margin-bottom:14px}
.mtab{padding:7px 14px;border-radius:50px;border:2px solid #e0d6f0;background:var(--white);font-family:'Nunito';font-size:11px;font-weight:700;cursor:pointer;color:var(--text-l)}
.mtab.act{border-color:var(--red);color:var(--red);background:rgba(239,83,80,.04)}
.mq{font-family:'Fredoka';font-size:clamp(30px,7vw,48px);color:var(--dark);margin-bottom:18px}
.mopts{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;max-width:260px;margin:0 auto}
.mopt{padding:12px;border-radius:12px;background:var(--bg);border:3px solid #e8e0f0;font-family:'Fredoka';font-size:20px;font-weight:700;cursor:pointer;transition:.2s;color:var(--dark);text-align:center}
.mopt:hover{border-color:var(--purple);transform:scale(1.03)}
.mopt.ok{background:var(--green-l);border-color:var(--green);color:var(--green)}
.mopt.no{background:var(--pink-l);border-color:var(--red);color:var(--red)}
.mscore{font-family:'Fredoka';font-size:14px;color:var(--text-l);margin-top:12px}

/* SENTENCES */
.sent-area{background:var(--white);border-radius:var(--r);box-shadow:0 3px 16px rgba(0,0,0,.04);overflow:hidden;margin-bottom:14px}
.sent-prompt{padding:16px;background:var(--pink-l);border-bottom:3px solid var(--pink);text-align:center}
.sent-prompt .sim{font-size:48px;display:block;margin-bottom:4px}
.sent-prompt h4{font-family:'Fredoka';font-size:15px;color:var(--pink)}
.sent-zone{padding:16px}
.sslot{min-height:42px;border:3px dashed #f0d6e6;border-radius:10px;padding:6px;display:flex;flex-wrap:wrap;gap:5px;align-items:center;margin-bottom:12px;justify-content:center}
.sword{padding:7px 14px;border-radius:8px;font-family:'Fredoka';font-size:14px;font-weight:600;cursor:pointer;transition:.2s}
.sword:hover{transform:scale(1.04)}
.sword.ws{background:#e3f2fd;color:#1565c0}.sword.wv{background:#e8f5e9;color:#2e7d32}
.sword.wo{background:#fff3e0;color:#e65100}.sword.wa{background:#f3e5f5;color:#7b1fa2}
.sword.placed{opacity:.3;pointer-events:none}
.sresult{text-align:center;padding:10px;font-family:'Fredoka';font-size:16px;min-height:24px}
.sresult.ok{color:var(--green)}.sresult.no{color:var(--red)}

/* DISCOVERY MODULE (replaces calculator) */
.disc-wrap{background:var(--white);border-radius:var(--r);box-shadow:0 3px 16px rgba(0,0,0,.04);overflow:hidden;margin-bottom:14px}
.disc-header{padding:16px;text-align:center;border-bottom:3px solid}
.disc-header .dico{font-size:48px;display:block;margin-bottom:6px}
.disc-header h4{font-family:'Fredoka';font-size:17px;margin-bottom:2px}
.disc-header p{font-size:12px;color:var(--text-l);font-weight:600}
.disc-body{padding:16px}
.disc-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:14px}
.disc-card{padding:16px 12px;border-radius:14px;text-align:center;cursor:pointer;transition:.2s;border:3px solid transparent}
.disc-card:hover{transform:scale(1.03)}
.disc-card .de{font-size:36px;display:block;margin-bottom:6px}
.disc-card .dl{font-family:'Fredoka';font-size:13px;font-weight:600}
.disc-card.selected{border-color:var(--green);background:var(--green-l)}
.disc-card.correct{border-color:var(--green);background:var(--green-l)}
.disc-card.wrong{border-color:var(--red);background:var(--pink-l)}
.disc-question{text-align:center;font-family:'Fredoka';font-size:16px;color:var(--dark);margin-bottom:14px;padding:12px;background:var(--bg);border-radius:12px}
.disc-question .dq-emoji{font-size:40px;display:block;margin-bottom:6px}
.disc-score{text-align:center;font-family:'Fredoka';font-size:14px;color:var(--text-l);margin-top:10px}

/* CREATOR */
.cr-wrap{background:var(--white);border-radius:var(--r);box-shadow:0 3px 16px rgba(0,0,0,.04);overflow:hidden;margin-bottom:14px}
.cr-top{padding:12px;background:var(--orange-l);border-bottom:3px solid var(--orange);text-align:center}
.cr-top h4{font-family:'Fredoka';font-size:14px;color:var(--orange);margin-bottom:2px}
.cr-top p{font-size:11px;color:var(--text-l);font-weight:600}
.cr-tools{padding:8px 12px;display:flex;gap:4px;flex-wrap:wrap;background:#fefaf3;border-bottom:1px solid #f0e8d8}
.ctool{padding:5px 10px;border-radius:7px;border:2px solid transparent;background:var(--white);font-size:12px;font-weight:700;cursor:pointer;transition:.2s}
.ctool:hover,.ctool.act{border-color:var(--orange)}
.cr-grid{display:grid;gap:2px;padding:10px;background:#fefaf3}
.ccell{aspect-ratio:1;border-radius:4px;background:#f5efe5;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:clamp(12px,2.5vw,18px);transition:.15s;border:2px solid transparent}
.ccell:hover{border-color:var(--orange)}

.ftr{background:var(--dark);color:rgba(255,255,255,.6);text-align:center;padding:30px 20px 18px;margin-top:30px;border-top-left-radius:28px;border-top-right-radius:28px}
.ftr .fl{font-family:'Fredoka';font-size:20px;font-weight:700;margin-bottom:5px}
.ftr p{font-size:11px;max-width:320px;margin:0 auto 10px;line-height:1.4}
.ftr .copy{font-size:10px;opacity:.3;border-top:1px solid rgba(255,255,255,.05);padding-top:10px}

@keyframes popIn{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes celebrate{0%{transform:scale(1)}50%{transform:scale(1.2) rotate(5deg)}100%{transform:scale(1)}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.celebrate{animation:celebrate .5s ease}

@media(max-width:700px){.mg{grid-template-columns:1fr}.lgrid{grid-template-columns:repeat(5,1fr)}.age-cards{flex-direction:column;align-items:center}.world.ew{grid-template-columns:repeat(6,1fr)}.world.bw{grid-template-columns:repeat(8,1fr)}}
</style>
</head>
<body>

<div class="hdr">
  <span class="logo" onclick="goHome()"><span class="c1">i</span><span class="c2">Play</span> <span class="c3">i</span><span class="c4">Learn</span></span>
  <div class="hdr-r">
    <div class="streak-badge" id="hdrStreak">üî• 0</div>
    <div class="hdr-profile" id="hdrProfile" onclick="goProfiles()" style="display:none">
      <div class="hp-av" id="hdrAv">üßí</div>
      <span class="hp-name" id="hdrName">Player</span>
    </div>
    <div class="lang-sw">
      <button class="lang-b act" onclick="setLang('en',this)">English</button>
      <button class="lang-b" onclick="setLang('tn',this)">Setswana</button>
    </div>
  </div>
</div>

<!-- PROFILE SELECT -->
<div id="v-profiles" class="view act">
  <div class="profile-screen">
    <h1>üëã Who's Playing?</h1>
    <p class="sub">Pick your profile or create a new one!</p>
    <div class="profile-cards" id="profileCards"></div>
  </div>
</div>

<!-- PROFILE CREATE -->
<div id="v-newprofile" class="view">
  <div class="profile-screen">
    <h1>üåü New Player!</h1>
    <p class="sub">Let's set up your profile</p>
    
    <p class="pf-label" style="text-align:center;margin-bottom:12px">Choose your avatar</p>
    <div class="avatar-grid" id="avatarGrid"></div>
    
    <div class="profile-form">
      <label class="pf-label">What's your name?</label>
      <input class="pf-input" id="pfName" type="text" placeholder="e.g. Mpho" maxlength="20">
      
      <label class="pf-label">How old are you?</label>
      <div class="age-pills" id="agePills">
        <div class="age-pill" onclick="selAge(1,this)">1</div>
        <div class="age-pill" onclick="selAge(2,this)">2</div>
        <div class="age-pill" onclick="selAge(3,this)">3</div>
        <div class="age-pill" onclick="selAge(4,this)">4</div>
        <div class="age-pill" onclick="selAge(5,this)">5</div>
      </div>
      
      <button class="pf-submit" id="pfSubmit" onclick="createProfile()" disabled>Let's Go! üöÄ</button>
    </div>
    
    <button class="back" onclick="goProfiles()" style="margin-top:8px">‚Üê Back</button>
  </div>
</div>

<!-- HOME -->
<div id="v-home" class="view">
  <div class="age-sel">
    <h1 id="homeGreeting">üëã Welcome!</h1>
    <p class="sub">How old is your little one?</p>
    <div class="age-cards">
      <div class="acard exp" onclick="goMods('explorer')"><span class="em">üß∏</span><h2>Little Explorer</h2><span class="ages">Ages 1 - 3</span><p>Numbers, Letters and First Code!</p></div>
      <div class="acard bld" onclick="goMods('builder')"><span class="em">üöÄ</span><h2>Young Builder</h2><span class="ages">Ages 4 - 5</span><p>Sentences, Maths, Coding and Discovery!</p></div>
    </div>
  </div>
</div>

<!-- EXPLORER MODS -->
<div id="v-explorer" class="view"><div class="mods">
  <button class="back" onclick="goHome()">‚Üê Back</button>
  <div class="reward-bar">
    <div class="rb-streak"><span class="fire">üî•</span><div><span class="s-num" id="eStreakNum">0</span><br><span class="s-label">day streak</span></div></div>
    <div class="rb-medals" id="eMedals"></div>
    <div class="rb-stars" id="eStarsTotal">‚≠ê 0</div>
  </div>
  <h2>üß∏ Little Explorer</h2><p class="sub">Pick a learning adventure!</p>
  <div class="mg" id="eModGrid"></div>
</div></div>

<!-- BUILDER MODS -->
<div id="v-builder" class="view"><div class="mods">
  <button class="back" onclick="goHome()">‚Üê Back</button>
  <div class="reward-bar">
    <div class="rb-streak"><span class="fire">üî•</span><div><span class="s-num" id="bStreakNum">0</span><br><span class="s-label">day streak</span></div></div>
    <div class="rb-medals" id="bMedals"></div>
    <div class="rb-stars" id="bStarsTotal">‚≠ê 0</div>
  </div>
  <h2>üöÄ Young Builder</h2><p class="sub">Choose your challenge!</p>
  <div class="mg" id="bModGrid"></div>
</div></div>

<!-- NUMBERS -->
<div id="v-e-num" class="view"><div class="ga">
  <button class="back" onclick="goMods(AG)">‚Üê Back</button>
  <h2>üî¢ Let's Count!</h2><p class="sub">Tap arrows to count</p>
  <div class="prog"><span class="star">‚≠ê</span><div class="prog-t"><div class="prog-f" id="np" style="width:5%"></div></div><span class="prog-tx" id="npt">1/20</span></div>
  <div class="wcard"><div class="big blue" id="bigNum">1</div><div class="word" id="nwEn">One</div><div class="tlang" id="nwTn">Setswana: Nngwe</div><div class="dots" id="nDots"></div></div>
  <div class="ctrls"><button class="cbtn prev" onclick="chgN(-1)">‚Üê</button><button class="cbtn spk" onclick="spkN()">üîä</button><button class="cbtn next" onclick="chgN(1)">‚Üí</button></div>
</div></div>

<!-- LETTERS -->
<div id="v-e-let" class="view"><div class="ga">
  <button class="back" onclick="goMods(AG)">‚Üê Back</button>
  <h2>üî§ Let's Spell!</h2><p class="sub">Tap a letter to hear it!</p>
  <div class="prog"><span class="star">‚≠ê</span><div class="prog-t"><div class="prog-f" id="lp" style="width:4%"></div></div><span class="prog-tx" id="lpt">A/Z</span></div>
  <div class="wcard"><div class="big green" id="bigLet">A</div><div class="word" id="lWord"><span style="color:var(--green)">A</span> for Apple</div><div class="tlang" id="lTn">Setswana: Apole</div></div>
  <div class="lgrid" id="lGrid"></div>
</div></div>

<!-- EXPLORER CODE -->
<div id="v-e-code" class="view"><div class="ga">
  <button class="back" onclick="goMods('explorer')">‚Üê Back</button>
  <h2>üê¢ Code Adventure</h2><p class="sub">Guide the turtle to the star!</p>
  <div class="code-wrap">
    <div class="ch-bar e-ch"><div class="ch-info"><h4 id="eCh">Today's Challenge<span class="dbadge" id="eDay"></span></h4><p id="eChD"></p></div><div class="ch-stars" id="eChSt">‚òÜ‚òÜ‚òÜ</div></div>
    <div class="cbody">
      <div class="concept c-seq" id="eCon"><div class="ci" id="eCI">üìã</div><div><h5 id="eCT"></h5><p id="eCD"></p></div></div>
      <p class="lbl">Blocks</p><div class="btray" id="eTray"></div>
      <p class="lbl">Your Code</p><div class="seq" id="eSeq"><span class="seq-ph">Tap blocks!</span></div>
      <div class="world ew" id="eW"></div>
      <div class="rrow"><button class="rbtn run" id="eRun" onclick="runE()">‚ñ∂ Run Code!</button><button class="rbtn clr" onclick="clrE()">üóë</button></div>
    </div>
  </div>
</div></div>

<!-- GAME WORLD (educational) -->
<div id="v-e-create" class="view"><div class="ga">
  <button class="back" onclick="goMods('explorer')">‚Üê Back</button>
  <h2>üé® My Game World</h2><p class="sub">Pick a tool and tap the grid!</p>
  <div class="cr-wrap">
    <div class="cr-top"><h4 id="crTitle">Build a Farm!</h4><p id="crDesc">Place animals and plants on the farm</p></div>
    <div class="cr-tools" id="crTools"></div>
    <div class="cr-grid" id="crGrid" style="grid-template-columns:repeat(8,1fr)"></div>
    <div style="padding:8px 12px"><div class="rrow"><button class="rbtn run" onclick="playCr()">‚ñ∂ Play!</button><button class="rbtn clr" onclick="initCr()">üóë</button></div></div>
  </div>
</div></div>

<!-- SENTENCES -->
<div id="v-b-sent" class="view"><div class="ga">
  <button class="back" onclick="goMods('builder')">‚Üê Back</button>
  <h2>üìù Sentence Builder</h2><p class="sub">Arrange words to make a sentence!</p>
  <div class="prog"><span class="star">‚≠ê</span><div class="prog-t"><div class="prog-f" id="sp" style="width:0%"></div></div><span class="prog-tx" id="spt">0/5</span></div>
  <div class="sent-area">
    <div class="sent-prompt"><span class="sim" id="sEm">üê±</span><h4 id="sPr">Make a sentence!</h4></div>
    <div class="sent-zone">
      <p class="lbl">Your Sentence</p><div class="sslot" id="sSlot"></div>
      <p class="lbl">Word Bank</p><div style="display:flex;flex-wrap:wrap;gap:5px;justify-content:center;margin-bottom:10px" id="sBank"></div>
      <div class="sresult" id="sRes"></div>
      <div class="rrow"><button class="rbtn" style="background:var(--pink)" onclick="chkS()">‚úì Check!</button><button class="rbtn clr" onclick="rstS()">‚Ü∫</button></div>
    </div>
  </div>
</div></div>

<!-- MATHS -->
<div id="v-b-math" class="view"><div class="ga">
  <button class="back" onclick="goMods('builder')">‚Üê Back</button>
  <h2>üßÆ Maths Time!</h2><p class="sub">Solve and pick the answer!</p>
  <div class="math-tabs"><button class="mtab act" onclick="setMT('add',this)">‚ûï Add</button><button class="mtab" onclick="setMT('sub',this)">‚ûñ Subtract</button><button class="mtab" onclick="setMT('mul',this)">‚úï Multiply</button></div>
  <div class="prog"><span class="star">‚≠ê</span><div class="prog-t"><div class="prog-f" id="mp" style="width:0%"></div></div><span class="prog-tx" id="mpt">0/10</span></div>
  <div class="wcard"><div class="mq" id="mathQ">2 + 3 = ?</div><div class="mopts" id="mathO"></div><div class="mscore" id="mathS">Score: 0</div></div>
</div></div>

<!-- BUILDER CODE -->
<div id="v-b-code" class="view"><div class="ga">
  <button class="back" onclick="goMods('builder')">‚Üê Back</button>
  <h2>ü§ñ Code Lab</h2><p class="sub">Complete today's mission!</p>
  <div class="code-wrap">
    <div class="ch-bar b-ch"><div class="ch-info"><h4 id="bCh">Mission<span class="dbadge" id="bDay"></span></h4><p id="bChD"></p></div><div class="ch-stars" id="bChSt">‚òÜ‚òÜ‚òÜ</div></div>
    <div class="cbody">
      <div class="concept c-loop" id="bCon"><div class="ci" id="bCI">üîÅ</div><div><h5 id="bCT"></h5><p id="bCD"></p></div></div>
      <p class="lbl">Commands</p><div class="btray" id="bTray"></div>
      <p class="lbl">Your Program</p><div class="seq" id="bSeq"><span class="seq-ph">Add commands!</span></div>
      <div class="world bw" id="bW"></div>
      <div class="rrow"><button class="rbtn run" id="bRun" onclick="runB()">‚ñ∂ Run!</button><button class="rbtn clr" onclick="clrB()">üóë</button></div>
    </div>
  </div>
</div></div>

<!-- DISCOVERY (replaces calculator) -->
<div id="v-b-disc" class="view"><div class="ga">
  <button class="back" onclick="goMods('builder')">‚Üê Back</button>
  <h2 id="discTitle">üè† Discovery</h2><p class="sub" id="discSub">Learn something new!</p>
  <div class="disc-wrap">
    <div class="disc-header" id="discHead" style="border-color:var(--teal);background:var(--teal-l)"><span class="dico" id="discIco">üè†</span><h4 id="discQ">Where does the cup go?</h4><p id="discHint">Tap the right answer!</p></div>
    <div class="disc-body">
      <div class="disc-question" id="discPrompt"><span class="dq-emoji" id="discEmoji">üçµ</span><span id="discAsk">This belongs in the...</span></div>
      <div class="disc-grid" id="discGrid"></div>
      <div class="disc-score" id="discScore">0 / 5</div>
    </div>
  </div>
</div></div>

<!-- COMPLETION SCREEN -->
<div id="v-complete" class="view"><div class="ga">
  <div class="complete-screen">
    <span class="trophy" id="compTrophy">üèÜ</span>
    <h3 id="compTitle">Challenge Complete!</h3>
    <p id="compMsg">You earned 3 stars!</p>
    <div class="medal-earned" id="compMedal"></div>
    <div class="streak-msg" id="compStreak">üî• 3 day streak!</div>
    <div class="timer" id="compTimer">17:59:59</div>
    <p style="font-size:12px;color:var(--text-l);font-weight:600;margin-bottom:16px">New challenge unlocks in...</p>
    <button class="home-btn" onclick="goMods(AG)">‚Üê Back to Menu</button>
  </div>
</div></div>

<footer class="ftr">
  <div class="fl"><span class="c1">i</span><span class="c2">Play</span> <span class="c3">i</span><span class="c4">Learn</span></div>
  <p>Making learning fun for kids!</p>
  <p class="copy">&copy; 2026 iPlay iLearn. Built with ‚ù§Ô∏è by Mpho Montshusi.</p>
</footer>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let lang='en',AG='';
const AVATARS=['üßí','üëß','üë¶','üßíüèæ','üëßüèæ','üë¶üèæ','üßíüèΩ','üëßüèΩ','üë¶üèΩ','üêª','ü¶Å','üêØ','üê∏','ü¶ä','üê∞','üêº','ü¶Ñ','üê∂'];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE SYSTEM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let currentProfile=null;
let selectedAvatar=AVATARS[0];
let selectedAge=null;

// Storage with fallback for environments that block localStorage
const memStore={};
function sGet(k){try{const v=localStorage.getItem(k);return v}catch(e){return memStore[k]||null}}
function sSet(k,v){try{localStorage.setItem(k,v)}catch(e){}memStore[k]=v}
function sRem(k){try{localStorage.removeItem(k)}catch(e){}delete memStore[k]}

function getProfiles(){try{return JSON.parse(sGet('iplayProfiles'))||[]}catch(e){return[]}}
function saveProfiles(p){sSet('iplayProfiles',JSON.stringify(p))}
function setCurrentProfileId(id){sSet('iplayCurrentProfile',id)}
function getCurrentProfileId(){return sGet('iplayCurrentProfile')||null}

function goProfiles(){
  show('profiles');
  const profiles=getProfiles();
  const cards=document.getElementById('profileCards');
  cards.innerHTML=profiles.map((p,i)=>`
    <div class="pcard" style="position:relative" onclick="selectProfile('${p.id}')">
      <button class="pcard-del" onclick="event.stopPropagation();deleteProfile('${p.id}')">‚úï</button>
      <span class="pav">${p.avatar}</span>
      <div class="pname">${p.name}</div>
      <div class="page">Age ${p.age}</div>
      ${p.streak>0?`<div class="pstreak">üî• ${p.streak} days</div>`:''}
    </div>
  `).join('')+`
    <div class="pcard-add" onclick="goNewProfile()">
      <span class="plus">+</span>
      <span class="atxt">Add Player</span>
    </div>
  `;
}

function goNewProfile(){
  show('newprofile');
  selectedAvatar=AVATARS[0];selectedAge=null;
  document.getElementById('pfName').value='';
  document.getElementById('pfSubmit').disabled=true;
  document.getElementById('avatarGrid').innerHTML=AVATARS.map((a,i)=>
    `<div class="avatar-opt${i===0?' sel':''}" onclick="pickAvatar(${i},this)">${a}</div>`
  ).join('');
}

function pickAvatar(idx,el){
  selectedAvatar=AVATARS[idx];
  document.querySelectorAll('.avatar-opt').forEach(x=>x.classList.remove('sel'));
  el.classList.add('sel');
  checkFormReady();
}

function selAge(age,el){
  selectedAge=age;
  document.querySelectorAll('.age-pill').forEach(x=>x.classList.remove('sel'));
  el.classList.add('sel');
  checkFormReady();
}

function checkFormReady(){
  const name=document.getElementById('pfName').value.trim();
  document.getElementById('pfSubmit').disabled=!(name&&selectedAge&&selectedAvatar);
}

// Listen for name input
document.addEventListener('DOMContentLoaded',()=>{
  const inp=document.getElementById('pfName');
  if(inp)inp.addEventListener('input',checkFormReady);
});

function createProfile(){
  const name=document.getElementById('pfName').value.trim();
  if(!name||!selectedAge)return;
  const profiles=getProfiles();
  const id='p_'+Date.now();
  const profile={id,name,age:selectedAge,avatar:selectedAvatar,streak:0,totalStars:0,medals:[],created:Date.now()};
  profiles.push(profile);
  saveProfiles(profiles);
  selectProfile(id);
}

function selectProfile(id){
  const profiles=getProfiles();
  currentProfile=profiles.find(p=>p.id===id);
  if(!currentProfile)return;
  setCurrentProfileId(id);
  
  // Update header
  document.getElementById('hdrProfile').style.display='flex';
  document.getElementById('hdrAv').textContent=currentProfile.avatar;
  document.getElementById('hdrName').textContent=currentProfile.name;
  
  // Update streak badge
  const group=currentProfile.age<=3?'explorer':'builder';
  const gs=getGroupStats(group);
  document.getElementById('hdrStreak').textContent='üî• '+gs.streak;
  
  // Go directly to the right module screen
  goMods(group);
}

function deleteProfile(id){
  if(!confirm('Remove this player?'))return;
  let profiles=getProfiles();
  profiles=profiles.filter(p=>p.id!==id);
  saveProfiles(profiles);
  // Also remove their game state
  sRem('iplay_'+id);
  if(getCurrentProfileId()===id){
    setCurrentProfileId('');
    currentProfile=null;
    document.getElementById('hdrProfile').style.display='none';
  }
  goProfiles();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Updated State (per-profile) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const nums={en:['Zero','One','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Eleven','Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen','Twenty'],tn:['Noto','Nngwe','Pedi','Tharo','Nne','Tlhano','Thataro','Supa','Robedi','Robongwe','Lesome','Lesome le motso','Lesome le bobedi','Lesome le boraro','Lesome le bone','Lesome le botlhano','Lesome le borataro','Lesome le bosupa','Lesome le borobedi','Lesome le borobongwe','Masome a mabedi']};
const letD={A:{en:'Apple',tn:'Apole'},B:{en:'Ball',tn:'Bolo'},C:{en:'Cat',tn:'Katse'},D:{en:'Dog',tn:'Nt≈°wa'},E:{en:'Elephant',tn:'Tlou'},F:{en:'Fish',tn:'Tlhapi'},G:{en:'Giraffe',tn:'Thutlwa'},H:{en:'House',tn:'Ntlo'},I:{en:'Ice cream',tn:'Aesekerimi'},J:{en:'Juice',tn:'Juse'},K:{en:'King',tn:'Kgosi'},L:{en:'Lion',tn:'Tau'},M:{en:'Moon',tn:'Ngwedi'},N:{en:'Nose',tn:'Nko'},O:{en:'Orange',tn:'Namune'},P:{en:'Pig',tn:'Kolobe'},Q:{en:'Queen',tn:'Mohumagadi'},R:{en:'Rain',tn:'Pula'},S:{en:'Sun',tn:'Letsatsi'},T:{en:'Tree',tn:'Setlhare'},U:{en:'Umbrella',tn:'Samporela'},V:{en:'Violin',tn:'Baelene'},W:{en:'Water',tn:'Metsi'},X:{en:'Xylophone',tn:'Xylophone'},Y:{en:'Yellow',tn:'Serolwana'},Z:{en:'Zebra',tn:'Pitsi ya naga'}};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPEECH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function spk(t){speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t);u.rate=.75;u.pitch=1.3;const v=speechSynthesis.getVoices();const f=['female','zira','samantha','karen','victoria'];let voice=v.find(x=>f.some(k=>x.name.toLowerCase().includes(k)));if(!voice)voice=v.find(x=>x.lang.startsWith('en'));if(voice)u.voice=voice;u.lang='en-US';speechSynthesis.speak(u)}
speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STREAK & REWARDS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const COOLDOWN=18*60*60*1000; // 18 hours
function getState(){if(!currentProfile)return{};try{return JSON.parse(sGet('iplay_'+currentProfile.id))||{}}catch(e){return{}}}
function saveState(s){if(!currentProfile)return;sSet('iplay_'+currentProfile.id,JSON.stringify(s))}
function getModState(mod){const s=getState();return s[mod]||{completed:false,completedAt:0,stars:0,streak:0,totalStars:0,medals:[]}}
function completeModule(mod,stars){const s=getState();const ms=s[mod]||{completed:false,completedAt:0,stars:0,streak:0,totalStars:0,medals:[]};const now=Date.now();const wasToday=ms.completedAt&&(now-ms.completedAt<COOLDOWN);if(!wasToday){ms.streak=(ms.completedAt&&(now-ms.completedAt<COOLDOWN*2))?ms.streak+1:1;ms.completed=true;ms.completedAt=now;ms.stars=Math.max(ms.stars,stars);ms.totalStars=(ms.totalStars||0)+stars;if(ms.streak>=3&&!ms.medals.includes('ü•â'))ms.medals.push('ü•â');if(ms.streak>=7&&!ms.medals.includes('ü•à'))ms.medals.push('ü•à');if(ms.streak>=14&&!ms.medals.includes('ü•á'))ms.medals.push('ü•á');if(ms.streak>=30&&!ms.medals.includes('üèÜ'))ms.medals.push('üèÜ');s[mod]=ms;saveState(s);
  // Sync to profile
  if(currentProfile){const profiles=getProfiles();const pi=profiles.findIndex(p=>p.id===currentProfile.id);if(pi>=0){const gs=getGroupStats(currentProfile.age<=3?'explorer':'builder');profiles[pi].streak=gs.streak;profiles[pi].totalStars=gs.stars;profiles[pi].medals=gs.medals;currentProfile=profiles[pi];saveProfiles(profiles)}}
  }return ms}
function isLocked(mod){const ms=getModState(mod);if(!ms.completed)return false;return(Date.now()-ms.completedAt)<COOLDOWN}
function getTimeLeft(mod){const ms=getModState(mod);const left=COOLDOWN-(Date.now()-ms.completedAt);return Math.max(0,left)}
function fmtTime(ms){const h=Math.floor(ms/3600000);const m=Math.floor((ms%3600000)/60000);const s=Math.floor((ms%60000)/1000);return`${h}h ${m}m ${s}s`}
function getGroupStats(group){const s=getState();let streak=0,stars=0,medals=[];const mods=group==='explorer'?['e-num','e-let','e-code','e-create']:['b-sent','b-math','b-code','b-disc'];mods.forEach(m=>{const ms=s[m]||{};streak=Math.max(streak,ms.streak||0);stars+=(ms.totalStars||0);(ms.medals||[]).forEach(med=>{if(!medals.includes(med))medals.push(med)})});return{streak,stars,medals}}

function showComplete(mod,stars){const ms=completeModule(mod,stars);show('complete');document.getElementById('compTrophy').textContent=stars>=3?'üèÜ':stars>=2?'‚≠ê':'üëç';document.getElementById('compTitle').textContent=stars>=3?'Perfect!':stars>=2?'Great Job!':'Good Try!';document.getElementById('compMsg').textContent=`You earned ${stars} star${stars!==1?'s':''}!`;document.getElementById('compMedal').textContent=ms.medals.length?ms.medals[ms.medals.length-1]:'';document.getElementById('compStreak').textContent=`üî• ${ms.streak} day streak!`;startTimer(mod)}
function startTimer(mod){const tick=()=>{const left=getTimeLeft(mod);if(left<=0){document.getElementById('compTimer').textContent='üéâ Ready!';return}document.getElementById('compTimer').textContent=fmtTime(left);requestAnimationFrame(tick)};tick()}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function show(id){document.querySelectorAll('.view').forEach(v=>v.classList.remove('act'));document.getElementById('v-'+id).classList.add('act');window.scrollTo({top:0,behavior:'smooth'})}
function goHome(){
  if(!currentProfile){goProfiles();return}
  show('home');AG='';
  document.getElementById('homeGreeting').textContent=currentProfile.avatar+' Hi, '+currentProfile.name+'!';
  // Auto-route by age
  if(currentProfile.age<=3){
    document.querySelectorAll('.acard.bld').forEach(c=>c.style.display='none');
    document.querySelectorAll('.acard.exp').forEach(c=>c.style.display='');
  }else{
    document.querySelectorAll('.acard.exp').forEach(c=>c.style.display='none');
    document.querySelectorAll('.acard.bld').forEach(c=>c.style.display='');
  }
}
function setLang(l,b){lang=l;document.querySelectorAll('.lang-b').forEach(x=>x.classList.remove('act'));b.classList.add('act')}
function goMods(g){AG=g;show(g);renderModGrid(g);const st=getGroupStats(g);const pre=g==='explorer'?'e':'b';document.getElementById(pre+'StreakNum').textContent=st.streak;document.getElementById(pre+'StarsTotal').textContent='‚≠ê '+st.stars;document.getElementById(pre+'Medals').innerHTML=(['ü•â','ü•à','ü•á','üèÜ']).map(m=>`<div class="medal${st.medals.includes(m)?' earned':''}">${m}</div>`).join('');document.getElementById('hdrStreak').textContent='üî• '+st.streak}

function renderModGrid(g){
  const mods=g==='explorer'?[
    {id:'e-num',bg:'linear-gradient(135deg,#4a9ff5,#6db3ff)',ico:'üî¢',t:'Numbers',d:'Count 1-20 in English & Setswana!',go:"Let's Count!"},
    {id:'e-let',bg:'linear-gradient(135deg,#5cc775,#7dd99a)',ico:'üî§',t:'Letters',d:'A for Apple! Learn A-Z!',go:"Let's Spell!"},
    {id:'e-code',bg:'linear-gradient(135deg,#9b6dff,#b894ff)',ico:'üê¢',t:'Code Adventure',d:'Daily challenges! Guide the turtle!',go:"Let's Code!"},
    {id:'e-create',bg:'linear-gradient(135deg,#f5a623,#ffc65c)',ico:'üé®',t:'Game World',d:'Build a farm, city or ocean!',go:"Let's Build!"}
  ]:[
    {id:'b-sent',bg:'linear-gradient(135deg,#f06292,#f48caf)',ico:'üìù',t:'Sentences',d:'Build sentences with word blocks!',go:"Let's Write!"},
    {id:'b-math',bg:'linear-gradient(135deg,#ef5350,#ff7b79)',ico:'üßÆ',t:'Maths',d:'Adding, subtracting, multiplying!',go:"Let's Solve!"},
    {id:'b-code',bg:'linear-gradient(135deg,#9b6dff,#c4a3ff)',ico:'ü§ñ',t:'Code Lab',d:'Daily missions! Loops & conditions!',go:"Let's Code!"},
    {id:'b-disc',bg:'linear-gradient(135deg,#26a69a,#4dd0c1)',ico:'üåç',t:'Discovery',d:'Home, country & community!',go:"Let's Explore!"}
  ];
  const grid=document.getElementById(g==='explorer'?'eModGrid':'bModGrid');
  grid.innerHTML=mods.map(m=>{
    const locked=isLocked(m.id);const ms=getModState(m.id);
    return`<div class="mc${locked?' locked':''}" style="background:${m.bg}" onclick="${locked?'':'go(\''+m.id+'\')'}">
      <span class="ico">${m.ico}</span><h3>${m.t}</h3><p>${m.d}</p>
      ${ms.streak>0?'<div style="margin-top:6px;font-size:11px;opacity:.8">üî•'+ms.streak+' streak | ‚≠ê'+ms.totalStars+'</div>':''}
      <div class="go">${locked?'üîí Locked':m.go+' ‚Üí'}</div>
      ${locked?'<div class="lock-timer"><div class="lock-ico">üîí</div><div class="lock-txt">'+fmtTime(getTimeLeft(m.id))+'</div></div>':''}
    </div>`}).join('')}

function go(id){show(id);init(id)}
function init(id){
  if(id==='e-num')updN();if(id==='e-let'){bldLG();updL()}
  if(id==='e-code')initEC();if(id==='e-create')initCr();
  if(id==='b-sent')ldS();if(id==='b-math')newMQ();
  if(id==='b-code')initBC();if(id==='b-disc')initDisc()}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NUMBERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let cN=1;
function chgN(d){cN=Math.max(0,Math.min(20,cN+d));updN();document.getElementById('bigNum').classList.add('celebrate');setTimeout(()=>document.getElementById('bigNum').classList.remove('celebrate'),500)}
function updN(){document.getElementById('bigNum').textContent=cN;document.getElementById('nwEn').textContent=nums.en[cN];document.getElementById('nwTn').textContent='Setswana: '+nums.tn[cN];document.getElementById('nDots').innerHTML=Array.from({length:cN},(_,i)=>`<div class="dot" style="animation-delay:${i*.04}s;background:hsl(${i*25%360},70%,60%)"></div>`).join('');document.getElementById('np').style.width=(cN/20*100)+'%';document.getElementById('npt').textContent=cN+'/20';if(cN===20)showComplete('e-num',3)}
function spkN(){spk(cN+'. '+nums[lang==='tn'?'tn':'en'][cN])}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LETTERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let cL='A';
function bldLG(){document.getElementById('lGrid').innerHTML='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map(l=>`<div class="lcell ${l===cL?'act':''}" onclick="selL('${l}')">${l}</div>`).join('')}
function selL(l){cL=l;updL();bldLG();document.getElementById('bigLet').classList.add('celebrate');setTimeout(()=>document.getElementById('bigLet').classList.remove('celebrate'),500);spk(l+' for '+(lang==='tn'?letD[l].tn:letD[l].en));if(l==='Z')showComplete('e-let',3)}
function updL(){const d=letD[cL];document.getElementById('bigLet').textContent=cL;document.getElementById('lWord').innerHTML=`<span style="color:var(--green)">${cL}</span> for ${d.en}`;document.getElementById('lTn').textContent='Setswana: '+d.tn;const i=cL.charCodeAt(0)-65;document.getElementById('lp').style.width=((i+1)/26*100)+'%';document.getElementById('lpt').textContent=cL+'/Z'}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXPLORER CODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const eLvls=[
  {t:'Straight Path',d:'Move the turtle to the star!',con:'Sequences',cd:'Code runs step by step. Each block happens in order!',g:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,'T',0,0,0,'S',0,0],[0,0,0,0,0,0,0,0]],av:['move']},
  {t:'Go Up!',d:'The star is above! Go up then forward!',con:'Directions',cd:'Go Forward moves right. Go Up moves up. Combine them!',g:[[0,0,0,0,0,0,0,0],[0,0,0,'S',0,0,0,0],[0,0,0,0,0,0,0,0],[0,'T',0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],av:['move','left']},
  {t:'Around the Wall!',d:'There is a wall! Go around it!',con:'Planning',cd:'Look at the path first. Plan your moves!',g:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,'S',0,0,0],[0,'T',0,'W',0,0,0,0],[0,0,0,0,0,0,0,0]],av:['move','left','right']},
  {t:'Jump Over!',d:'Jump over the wall!',con:'Special Moves',cd:'Jump Forward skips 2 spaces! Use it for walls!',g:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,'T',0,'W',0,'S',0,0],[0,0,0,0,0,0,0,0]],av:['move','jump']},
  {t:'Zigzag!',d:'Go up, forward, down, forward!',con:'Combining',cd:'Mix different moves together!',g:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,'W',0,0,0,0,0],[0,'T',0,0,'W',0,0,0],[0,0,0,0,0,'S',0,0]],av:['move','left','right']},
  {t:'Dance Party!',d:'Get the star and dance!',con:'Fun Actions',cd:'Programs can do fun things at the end!',g:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,'T',0,0,'S',0,0,0],[0,0,0,0,0,0,0,0]],av:['move','dance']},
  {t:'Big Adventure!',d:'A long path!',con:'Patience',cd:'Real programs can be long. One step at a time!',g:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,'S',0],[0,0,0,0,0,0,0,0],[0,'T',0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],av:['move','left','right','jump']}
];
let eB=[],eTX,eTY,eLv;
function dayLv(lvls){const d=new Date();return Math.floor((d-new Date(d.getFullYear(),0,0))/(864e5))%lvls.length}
function initEC(){eLv=dayLv(eLvls);const l=eLvls[eLv];document.getElementById('eDay').textContent='Day '+(eLv+1);document.getElementById('eCh').innerHTML=l.t+'<span class="dbadge">Day '+(eLv+1)+'/7</span>';document.getElementById('eChD').textContent=l.d;document.getElementById('eCT').textContent=l.con;document.getElementById('eCD').textContent=l.cd;
const bt={move:{l:'‚û°Ô∏è Go Forward',c:'b-m'},left:{l:'‚¨ÜÔ∏è Go Up',c:'b-t'},right:{l:'‚¨áÔ∏è Go Down',c:'b-t'},jump:{l:'‚è© Jump Forward',c:'b-a'},dance:{l:'üíÉ Dance!',c:'b-a'}};
document.getElementById('eTray').innerHTML=l.av.map(b=>`<div class="blk ${bt[b].c}" onclick="eAdd('${b}')">${bt[b].l}</div>`).join('');eB=[];rES();rstEW()}
function eAdd(t){if(eB.length>=12)return;const lb={move:'‚û°Ô∏è Forward',left:'‚¨ÜÔ∏è Up',right:'‚¨áÔ∏è Down',jump:'‚è© Jump',dance:'üíÉ Dance'};const cl={move:'b-m',left:'b-t',right:'b-t',jump:'b-a',dance:'b-a'};eB.push({type:t,label:lb[t],cls:cl[t]});rES()}
function eRm(i){eB.splice(i,1);rES()}
function rES(){const s=document.getElementById('eSeq');if(!eB.length){s.innerHTML='<span class="seq-ph">Tap blocks!</span>';return}s.innerHTML=eB.map((b,i)=>`<div class="blk ${b.cls}">${b.label}<button class="rx" onclick="event.stopPropagation();eRm(${i})">‚úï</button></div>`).join('')}
function clrE(){eB=[];rES();rstEW()}
function rstEW(){const g=eLvls[eLv].g;const w=document.getElementById('eW');let h='';for(let r=0;r<g.length;r++)for(let c=0;c<g[0].length;c++){let cl='wcell fl',ct='';if(g[r][c]==='T'){cl='wcell bt';ct='üê¢';eTX=c;eTY=r}else if(g[r][c]==='S'){cl='wcell gl';ct='‚≠ê'}else if(g[r][c]==='W')cl='wcell wl';h+=`<div class="${cl}" id="ec${r}_${c}">${ct}</div>`}const old=w.querySelector('.result-overlay');if(old)old.remove();w.innerHTML=h}
function runE(){rstEW();const g=eLvls[eLv].g;let steps=[];eB.forEach(b=>steps.push({...b}));if(!steps.length)return;const btn=document.getElementById('eRun');btn.disabled=true;btn.textContent='‚è≥...';let i=0;
function nx(){if(i>=steps.length){const gr=g.findIndex(r=>r.includes('S'));const gc=g[gr].indexOf('S');const won=eTX===gc&&eTY===gr;const w=document.getElementById('eW');const ov=document.createElement('div');ov.className='result-overlay act';if(won){document.getElementById('eChSt').textContent='‚≠ê‚≠ê‚≠ê';ov.innerHTML='<div class="ri">üéâ</div><div class="rm">Amazing!</div><div class="rs">You did it!</div><button class="rb" onclick="showComplete(\'e-code\',3)">Collect Reward!</button>'}else{ov.innerHTML='<div class="ri">ü§î</div><div class="rm">Try again!</div><div class="rs">The turtle missed the star</div><button class="rb" onclick="this.parentElement.classList.remove(\'act\');clrE()">Try Again</button>'}w.appendChild(ov);btn.disabled=false;btn.textContent='‚ñ∂ Run Code!';return}
const s=steps[i];const pv=document.getElementById('ec'+eTY+'_'+eTX);pv.textContent='';pv.className='wcell pt';
if(s.type==='move'){const nx2=eTX+1,ny=eTY;if(nx2<g[0].length&&g[ny][nx2]!=='W'){eTX=nx2}}
else if(s.type==='left'){const ny=eTY-1;if(ny>=0&&g[ny][eTX]!=='W')eTY=ny}
else if(s.type==='right'){const ny=eTY+1;if(ny<g.length&&g[ny][eTX]!=='W')eTY=ny}
else if(s.type==='jump'){const nx2=eTX+2;if(nx2<g[0].length)eTX=nx2}
const cur=document.getElementById('ec'+eTY+'_'+eTX);cur.textContent='üê¢';cur.className='wcell bt';if(s.type==='dance'){cur.style.animation='celebrate .5s';setTimeout(()=>cur.style.animation='',500)}
i++;setTimeout(nx,500)}nx()}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME WORLD (Educational) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const crThemes=[
  {t:'Build a Farm! üåæ',d:'Place animals and plants on the farm',tools:['üêÑ Cow','üêî Chicken','üê∑ Pig','üåΩ Corn','üåª Sunflower','üöú Tractor','üè† Barn','‚ùå Erase']},
  {t:'Build a City! üèôÔ∏è',d:'Create a town with buildings and cars',tools:['üè† House','üè• Hospital','üè´ School','üöó Car','üöå Bus','üå≥ Tree','üë® Person','‚ùå Erase']},
  {t:'Build an Ocean! üåä',d:'Fill the ocean with sea creatures',tools:['üêü Fish','üêô Octopus','ü¶Ä Crab','üêö Shell','üêã Whale','üåä Wave','üèùÔ∏è Island','‚ùå Erase']}
];
let crTool='',crData=[];
function initCr(){const theme=crThemes[dayLv(crThemes)];document.getElementById('crTitle').textContent=theme.t;document.getElementById('crDesc').textContent=theme.d;crTool=theme.tools[0].split(' ')[0];document.getElementById('crTools').innerHTML=theme.tools.map((t,i)=>{const e=t.split(' ')[0];return`<div class="ctool${i===0?' act':''}" onclick="crTool='${e}';document.querySelectorAll('.ctool').forEach(x=>x.classList.remove('act'));this.classList.add('act')">${t}</div>`}).join('');const g=document.getElementById('crGrid');const cols=window.innerWidth<700?6:8;g.style.gridTemplateColumns=`repeat(${cols},1fr)`;crData=new Array(cols*5).fill('');g.innerHTML=crData.map((_,i)=>`<div class="ccell" onclick="crData[${i}]=crTool==='‚ùå'?'':crTool;this.textContent=crData[${i}]"></div>`).join('')}
function playCr(){document.querySelectorAll('.ccell').forEach(c=>{if(c.textContent){c.style.animation='bounce .5s';setTimeout(()=>c.style.animation='',600)}});const filled=crData.filter(x=>x).length;if(filled>=8)showComplete('e-create',Math.min(3,Math.floor(filled/5)))}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SENTENCES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const sents=[{e:'üê±',w:['The','cat','is','sleeping'],c:'The cat is sleeping',t:['ws','wo','wv','wa']},{e:'üêï',w:['A','big','dog','runs'],c:'A big dog runs',t:['ws','wa','wo','wv']},{e:'‚òÄÔ∏è',w:['The','sun','is','bright'],c:'The sun is bright',t:['ws','wo','wv','wa']},{e:'üåßÔ∏è',w:['It','is','going','to','rain'],c:'It is going to rain',t:['ws','wv','wv','ws','wo']},{e:'üè†',w:['I','love','my','house'],c:'I love my house',t:['ws','wv','wa','wo']}];
let sI=0,sSc=0,sPl=[];
function ldS(){sI=0;sSc=0;const s=sents[sI];document.getElementById('sEm').textContent=s.e;document.getElementById('sRes').textContent='';sPl=[];rnS()}
function rnS(){const s=sents[sI];const sh=[...s.w.map((w,i)=>({w,i}))].sort(()=>Math.random()-.5);document.getElementById('sBank').innerHTML=sh.map(x=>{const pl=sPl.some(p=>p.i===x.i);return`<div class="sword ${s.t[x.i]}${pl?' placed':''}" onclick="plW(${x.i})">${x.w}</div>`}).join('');document.getElementById('sSlot').innerHTML=sPl.length?sPl.map(p=>`<div class="sword ws" style="background:#f0e8ff;color:var(--purple)">${p.w}</div>`).join(''):'<span class="seq-ph">Tap words!</span>'}
function plW(i){if(sPl.some(p=>p.i===i))return;sPl.push({w:sents[sI].w[i],i});rnS()}
function rstS(){sPl=[];document.getElementById('sRes').textContent='';rnS()}
function chkS(){const b=sPl.map(p=>p.w).join(' ');if(b===sents[sI].c){document.getElementById('sRes').textContent='üéâ Correct!';document.getElementById('sRes').className='sresult ok';sSc++;if(sSc>=5){setTimeout(()=>showComplete('b-sent',3),800);return}setTimeout(()=>{sI=(sI+1)%sents.length;sPl=[];document.getElementById('sEm').textContent=sents[sI].e;document.getElementById('sRes').textContent='';rnS()},1000)}else{document.getElementById('sRes').textContent='ü§î Try again!';document.getElementById('sRes').className='sresult no'}document.getElementById('sp').style.width=(sSc/5*100)+'%';document.getElementById('spt').textContent=sSc+'/5'}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MATHS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let mT='add',mSc=0,mTot=0,mAns=0;
function setMT(t,b){mT=t;document.querySelectorAll('.mtab').forEach(x=>x.classList.remove('act'));b.classList.add('act');mSc=0;mTot=0;newMQ()}
function newMQ(){let a,b,q,ans;if(mT==='add'){a=Math.floor(Math.random()*10)+1;b=Math.floor(Math.random()*10)+1;q=`${a} + ${b} = ?`;ans=a+b}else if(mT==='sub'){a=Math.floor(Math.random()*10)+5;b=Math.floor(Math.random()*a)+1;q=`${a} - ${b} = ?`;ans=a-b}else{a=Math.floor(Math.random()*5)+1;b=Math.floor(Math.random()*5)+1;q=`${a} √ó ${b} = ?`;ans=a*b}mAns=ans;document.getElementById('mathQ').textContent=q;const opts=new Set([ans]);while(opts.size<4)opts.add(Math.max(0,ans+Math.floor(Math.random()*8)-4));document.getElementById('mathO').innerHTML=[...opts].sort(()=>Math.random()-.5).map(o=>`<div class="mopt" onclick="chkM(${o},this)">${o}</div>`).join('');document.getElementById('mathS').textContent='Score: '+mSc+'/'+mTot}
function chkM(v,el){mTot++;if(v===mAns){el.classList.add('ok');mSc++;if(mSc>=10){setTimeout(()=>showComplete('b-math',3),800);return}setTimeout(newMQ,600)}else{el.classList.add('no');setTimeout(()=>el.classList.remove('no'),400)}document.getElementById('mathS').textContent='Score: '+mSc+'/'+mTot;document.getElementById('mp').style.width=(mSc/10*100)+'%';document.getElementById('mpt').textContent=mSc+'/10'}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BUILDER CODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const bLvls=[
  {t:'Repeat Power',d:'Use loops to move efficiently!',con:'Loops',cd:'Instead of "move" 5 times, use "repeat 5"!',ct:'loop',g:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,'R',0,0,0,0,0,'G',0,0],[0,0,0,0,0,0,0,0,0,0]],av:['move','left','right','repeat3','repeat5']},
  {t:'If Wall, Turn!',d:'The robot must decide!',con:'Conditions',cd:'IF wall ahead, THEN turn right!',ct:'cond',g:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,'G',0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,'R',0,0,'W',0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],av:['move','left','right','ifwall']},
  {t:'Collect Gems!',d:'Pick up every gem!',con:'Loops + Actions',cd:'Move AND collect on each step!',ct:'loop',g:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,'R',0,'I',0,'I',0,'I',0,'G'],[0,0,0,0,0,0,0,0,0,0]],av:['move','grab','repeat3']},
  {t:'Robot Delivery',d:'Grab the package and deliver!',con:'Multi-Step',cd:'Break big tasks into small steps!',ct:'seq',g:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,'G',0,0],[0,0,0,0,0,0,0,0,0,0],[0,'R',0,0,'I',0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],av:['move','left','right','grab','drop']},
  {t:'The Grand Maze',d:'Navigate the maze!',con:'Everything!',cd:'Use all your coding skills!',ct:'seq',g:[[0,0,0,0,0,0,0,0,0,0],[0,'G',0,'W',0,0,0,0,0,0],[0,0,0,'W',0,0,0,0,0,0],[0,'W','W','W',0,0,0,0,0,0],[0,'R',0,0,0,0,0,0,0,0]],av:['move','left','right','jump']}
];
let bB=[],bTX,bTY,bLv;
function initBC(){bLv=dayLv(bLvls);const l=bLvls[bLv];document.getElementById('bDay').textContent='Day '+(bLv+1);document.getElementById('bCh').innerHTML=l.t+'<span class="dbadge">Day '+(bLv+1)+'/5</span>';document.getElementById('bChD').textContent=l.d;document.getElementById('bCT').textContent=l.con;document.getElementById('bCD').textContent=l.cd;document.getElementById('bCon').className='concept c-'+l.ct;document.getElementById('bCI').textContent=l.ct==='loop'?'üîÅ':l.ct==='cond'?'üîÄ':l.ct==='func'?'üì¶':'üìã';
const bt={move:{l:'‚û°Ô∏è Move',c:'b-m'},left:{l:'‚¨ÜÔ∏è Up',c:'b-t'},right:{l:'‚¨áÔ∏è Down',c:'b-t'},jump:{l:'‚è© Jump',c:'b-a'},grab:{l:'ü§è Grab',c:'b-a'},drop:{l:'üì• Drop',c:'b-a'},repeat3:{l:'üîÅ √ó3',c:'b-l'},repeat5:{l:'üîÅ √ó5',c:'b-l'},ifwall:{l:'üîÄ If Wall‚ÜíTurn',c:'b-c'}};
document.getElementById('bTray').innerHTML=l.av.map(b=>`<div class="blk ${bt[b].c}" onclick="bAdd('${b}')">${bt[b].l}</div>`).join('');bB=[];rBS();rstBW()}
function bAdd(t){if(bB.length>=15)return;const lb={move:'‚û°Ô∏è',left:'‚¨ÜÔ∏è',right:'‚¨áÔ∏è',jump:'‚è©',grab:'ü§è',drop:'üì•',repeat3:'üîÅ√ó3',repeat5:'üîÅ√ó5',ifwall:'üîÄWall'};const cl={move:'b-m',left:'b-t',right:'b-t',jump:'b-a',grab:'b-a',drop:'b-a',repeat3:'b-l',repeat5:'b-l',ifwall:'b-c'};bB.push({type:t,label:lb[t],cls:cl[t]});rBS()}
function bRm(i){bB.splice(i,1);rBS()}
function rBS(){const s=document.getElementById('bSeq');if(!bB.length){s.innerHTML='<span class="seq-ph">Add commands!</span>';return}s.innerHTML=bB.map((b,i)=>`<div class="blk ${b.cls}">${b.label}<button class="rx" onclick="event.stopPropagation();bRm(${i})">‚úï</button></div>`).join('')}
function clrB(){bB=[];rBS();rstBW()}
function rstBW(){const g=bLvls[bLv].g;const w=document.getElementById('bW');let h='';for(let r=0;r<g.length;r++)for(let c=0;c<g[0].length;c++){let cl='wcell fl',ct='';if(g[r][c]==='R'){cl='wcell bt';ct='ü§ñ';bTX=c;bTY=r}else if(g[r][c]==='G'){cl='wcell gl';ct='üèÅ'}else if(g[r][c]==='W')cl='wcell wl';else if(g[r][c]==='I'){cl='wcell it';ct='üíé'}h+=`<div class="${cl}" id="bc${r}_${c}">${ct}</div>`}const old=w.querySelector('.result-overlay');if(old)old.remove();w.innerHTML=h}
function runB(){rstBW();const g=bLvls[bLv].g;let steps=[];bB.forEach(b=>{if(b.type==='repeat3'){const p=steps.slice(-1);if(p.length)for(let i=0;i<2;i++)steps.push({...p[0]})}else if(b.type==='repeat5'){const p=steps.slice(-1);if(p.length)for(let i=0;i<4;i++)steps.push({...p[0]})}else if(b.type==='ifwall')steps.push({type:'ifwall'});else steps.push({...b})});if(!steps.length)return;
const btn=document.getElementById('bRun');btn.disabled=true;btn.textContent='‚è≥...';let i=0,hasItem=false;
function nx(){if(i>=steps.length){const gr=g.findIndex(r=>r.includes('G'));const gc=g[gr].indexOf('G');const won=bTX===gc&&bTY===gr;const w2=document.getElementById('bW');const ov=document.createElement('div');ov.className='result-overlay act';if(won){document.getElementById('bChSt').textContent='‚≠ê‚≠ê‚≠ê';ov.innerHTML='<div class="ri">üéâ</div><div class="rm">Mission Complete!</div><button class="rb" onclick="showComplete(\'b-code\',3)">Collect Reward!</button>'}else{ov.innerHTML='<div class="ri">ü§î</div><div class="rm">Try again!</div><button class="rb" onclick="this.parentElement.classList.remove(\'act\');clrB()">Retry</button>'}w2.appendChild(ov);btn.disabled=false;btn.textContent='‚ñ∂ Run!';return}
const s=steps[i];const pv=document.getElementById('bc'+bTY+'_'+bTX);if(!hasItem){pv.textContent='';pv.className='wcell pt'}
if(s.type==='move'){const nx2=bTX+1;if(nx2<g[0].length&&g[bTY][nx2]!=='W')bTX=nx2}
else if(s.type==='left'){const ny=bTY-1;if(ny>=0&&g[ny][bTX]!=='W')bTY=ny}
else if(s.type==='right'){const ny=bTY+1;if(ny<g.length&&g[ny][bTX]!=='W')bTY=ny}
else if(s.type==='jump'){const nx2=bTX+2;if(nx2<g[0].length)bTX=nx2}
else if(s.type==='grab'){const c=document.getElementById('bc'+bTY+'_'+bTX);if(c.textContent.includes('üíé')){hasItem=true}}
else if(s.type==='drop')hasItem=false;
else if(s.type==='ifwall'){const nx2=bTX+1;if(nx2>=g[0].length||g[bTY][nx2]==='W'){const ny=bTY-1;if(ny>=0&&g[ny][bTX]!=='W')bTY=ny}}
const cur=document.getElementById('bc'+bTY+'_'+bTX);cur.textContent=hasItem?'ü§ñüíé':'ü§ñ';cur.className='wcell bt';
i++;setTimeout(nx,400)}nx()}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DISCOVERY MODULE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const discTypes=[
  {type:'home',title:'üè† Home Helper',sub:'Where do things belong?',color:'var(--teal)',bg:'var(--teal-l)',questions:[
    {emoji:'üçµ',ask:'Where does the cup go?',options:[{e:'üç≥',l:'Kitchen',ok:true},{e:'üõèÔ∏è',l:'Bedroom',ok:false},{e:'üöó',l:'Garage',ok:false},{e:'üå≥',l:'Garden',ok:false}]},
    {emoji:'üëü',ask:'Where do shoes go?',options:[{e:'üö™',l:'By the door',ok:true},{e:'üõÅ',l:'Bathroom',ok:false},{e:'üç≥',l:'Kitchen',ok:false},{e:'üõèÔ∏è',l:'On the bed',ok:false}]},
    {emoji:'üß∏',ask:'Where does teddy sleep?',options:[{e:'üõèÔ∏è',l:'Bedroom',ok:true},{e:'üç≥',l:'Kitchen',ok:false},{e:'üöó',l:'Car',ok:false},{e:'üå≥',l:'Outside',ok:false}]},
    {emoji:'ü™•',ask:'Where is the toothbrush?',options:[{e:'üõÅ',l:'Bathroom',ok:true},{e:'üç≥',l:'Kitchen',ok:false},{e:'üõèÔ∏è',l:'Bedroom',ok:false},{e:'üì∫',l:'Lounge',ok:false}]},
    {emoji:'üöó',ask:'Where does the car park?',options:[{e:'üè†',l:'Garage',ok:true},{e:'üõèÔ∏è',l:'Bedroom',ok:false},{e:'üç≥',l:'Kitchen',ok:false},{e:'üõÅ',l:'Bathroom',ok:false}]}
  ]},
  {type:'country',title:'üåç My South Africa',sub:'Learn about our country!',color:'var(--green)',bg:'var(--green-l)',questions:[
    {emoji:'ü¶Å',ask:'What is South Africa\'s big cat?',options:[{e:'ü¶Å',l:'Lion',ok:true},{e:'üêØ',l:'Tiger',ok:false},{e:'üê±',l:'House cat',ok:false},{e:'ü¶ä',l:'Fox',ok:false}]},
    {emoji:'üèîÔ∏è',ask:'What is the famous flat mountain?',options:[{e:'üèîÔ∏è',l:'Table Mountain',ok:true},{e:'üåã',l:'Volcano',ok:false},{e:'üèúÔ∏è',l:'Desert hill',ok:false},{e:'üóº',l:'Tower',ok:false}]},
    {emoji:'üáøüá¶',ask:'How many colors in our flag?',options:[{e:'6Ô∏è‚É£',l:'Six',ok:true},{e:'3Ô∏è‚É£',l:'Three',ok:false},{e:'4Ô∏è‚É£',l:'Four',ok:false},{e:'5Ô∏è‚É£',l:'Five',ok:false}]},
    {emoji:'üêò',ask:'Which is the biggest land animal here?',options:[{e:'üêò',l:'Elephant',ok:true},{e:'ü¶í',l:'Giraffe',ok:false},{e:'ü¶õ',l:'Hippo',ok:false},{e:'üêÉ',l:'Buffalo',ok:false}]},
    {emoji:'üèâ',ask:'What sport is the Springboks?',options:[{e:'üèâ',l:'Rugby',ok:true},{e:'‚öΩ',l:'Soccer',ok:false},{e:'üèÄ',l:'Basketball',ok:false},{e:'üéæ',l:'Tennis',ok:false}]}
  ]},
  {type:'town',title:'üèóÔ∏è Build the Town',sub:'Where do buildings go?',color:'var(--orange)',bg:'var(--orange-l)',questions:[
    {emoji:'ü§í',ask:'Someone is sick! Where do they go?',options:[{e:'üè•',l:'Hospital',ok:true},{e:'üè´',l:'School',ok:false},{e:'üè™',l:'Shop',ok:false},{e:'üè†',l:'Park',ok:false}]},
    {emoji:'üìö',ask:'Where do children learn?',options:[{e:'üè´',l:'School',ok:true},{e:'üè•',l:'Hospital',ok:false},{e:'üè™',l:'Shop',ok:false},{e:'‚õ™',l:'Church',ok:false}]},
    {emoji:'üî•',ask:'There is a fire! Who comes?',options:[{e:'üöí',l:'Fire truck',ok:true},{e:'üöå',l:'Bus',ok:false},{e:'üöó',l:'Car',ok:false},{e:'‚úàÔ∏è',l:'Plane',ok:false}]},
    {emoji:'üçû',ask:'Where do you buy food?',options:[{e:'üè™',l:'Shop',ok:true},{e:'üè´',l:'School',ok:false},{e:'üè•',l:'Hospital',ok:false},{e:'‚õ™',l:'Church',ok:false}]},
    {emoji:'üëÆ',ask:'Who keeps us safe?',options:[{e:'üëÆ',l:'Police',ok:true},{e:'üë®‚Äçüè´',l:'Teacher',ok:false},{e:'üë®‚Äçüç≥',l:'Chef',ok:false},{e:'üë®‚Äçüåæ',l:'Farmer',ok:false}]}
  ]}
];
let dI=0,dSc=0,dType;
function initDisc(){dType=discTypes[dayLv(discTypes)];dI=0;dSc=0;document.getElementById('discTitle').textContent=dType.title;document.getElementById('discSub').textContent=dType.sub;document.getElementById('discHead').style.borderColor=dType.color;document.getElementById('discHead').style.background=dType.bg;loadDQ()}
function loadDQ(){if(dI>=dType.questions.length){showComplete('b-disc',dSc>=4?3:dSc>=2?2:1);return}const q=dType.questions[dI];document.getElementById('discIco').textContent=q.emoji;document.getElementById('discEmoji').textContent=q.emoji;document.getElementById('discAsk').textContent=q.ask;document.getElementById('discScore').textContent=dSc+' / '+dType.questions.length;document.getElementById('discGrid').innerHTML=q.options.sort(()=>Math.random()-.5).map((o,i)=>`<div class="disc-card" style="background:${dType.bg}" onclick="chkD(${o.ok},this)"><span class="de">${o.e}</span><span class="dl">${o.l}</span></div>`).join('')}
function chkD(ok,el){if(ok){el.classList.add('correct');dSc++;dI++;setTimeout(loadDQ,800)}else{el.classList.add('wrong');setTimeout(()=>el.classList.remove('wrong'),500)}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function appStart(){
  try{
    const profiles=getProfiles();
    const lastId=getCurrentProfileId();
    if(lastId&&profiles.find(p=>p.id===lastId)){
      selectProfile(lastId);
    }else if(profiles.length>0){
      goProfiles();
    }else{
      goNewProfile();
    }
  }catch(e){
    console.error('appStart error:',e);
    goNewProfile();
  }
}
appStart();
</script>
</body>

</html>

